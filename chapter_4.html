<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"1wdm+E60zDxY6Mx2901ahQ==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"Ixabti4G6l0=","ct":"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"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>