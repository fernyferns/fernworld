<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"q0tZNEr5YPe/WiLpAk7HBg==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"9yXl9RbCtec=","ct":"IaI2f8fpDPZ/SQeMW84vglzf+qbWFMPO2BW3gb6u31I+btd4V9pkNhzAf2QzEeeXM3XA24MtRsw3D2FGPxS4W2f36czDxmvJJRhX4wYBaKaTu7MG085l5t+2wBzgI20amWjOLYj2fyE+jVGoIi/vgfPYsLCowaDuZ9YYwcp+1DWGI96vQRlgAv+CmArjoeOQKUc1pmNB6aU6Av9laxyf0fwxOFx01MaGxMz6Tyhr6s9IPDPWHZ4Agq6m5JmI+UCobQ5OKYrL5GO64uZTGyKyfiHjkvPFyY/ptUyczXRbWN1cu5x80PFowxMdozjURcrKJYKIRIiX1Mx4gy+Ww24uhbc243VNiM4GVyBSZlpbX5H6ZqgqonIIMfwWc4scsyTC6y2/IuGtcOexy5049z1vASjzQs4gcqf4BeNn08XKAKgCjb1BqnY7fwYJ5Inewg+iraTJTrf3UM1A0P/FJQabgyjWhkK6r74FZmNPaaRiWDKtsKxYgIfdo/x12apa9t2AHa79As5pzGKCXM6DzW7QJb2E5C6BGEMJm12X7lB5l3SnevL4CIGCLzdJmdHqs6RANnavP++7Ck1plo83JNa8nB3x1CTgZlyr+rdNO7814q6//+783E1nDIFHkazBqnEmAHWcbmlZJiDWD9MyyP8Z6JVp3MNCZE8sPGMk0GjFRnCA4i+EJfp8adQK7YeFqVCkF7TroVsn30s9g5XFhAx3VsMoOWi0roueJW4tuabr9kqn3IJ/ASbx3ob3IdFnIO6EvXIqDlqGBQDdN6T02Wry0sryeQCObY644p0l6QvKxs9M7ud/LwK0sydS08W6/Es3SESg0dpuGxUnZcdygWHHj+BuwIXgcHfU5Yyq+6eoVlo+0TLBtIJ89S7NtdprntWtmCyPnhllvajTUfJOGkFhElROqRsgsXASvdS0d1fmi7KPMsDyS54LHNDoot/UTGksQtpmSEmr2yTmQx40y6gw96y/r2I4LDtfVAeJarGqO8wIGbKHen5zx7G9MqatDLO03A1rSHXR/AIwkrBTHyxI4w0+43lRoO0Yo5iU1zBjRl1q4anEbBacGH0cSJzUfp/Bp6WAjxH9GSWRMfbBjKbWE/FBTTS0hCXtqiSXNwcfNe+T1oaLICSCymSxB2mGMBmQ2KWcofCMq+S8eiO7dK+YMWfqty2214Iu5RTvLE4y9xMSQhdfPWnJnebfD12Brao1fDdc6dEth5cxegAIB7IwLFlyZxYV+90jDI7qOBuCfoSfNfsSAFEjqrF5twjsyrOsAoyMfMNp//4htSfOnQgQRr0QsFjbjfsyyoHPUT91lFGyXhiM0Tjy8W2b6FDAVRMypQ9b3o5AuUSqgseqoVN+BDadm3WYqle1NwXECDh87HUVKh5/oikH0MhqH51cZvzS5MwE2M2CYLU7OOXIKjyJc+JY2BU4fPT2yqUTJ1wbSc2eguifRKNHQXQe0XzzivKmJ/q/EpM7Xb8liqDwzfjlxdLFmvjQoKdDQwz+s2FfRCdyNjq1LmhKGufEx4y5IBInViEfOqK6r2D8lauCjhYQ/rgfUGsXunq7sPipQa6BaM+Od1Fn8FPeDFCJUYtWcJ9CeKWN78dcZkWDyA+psmC+7/M6HxxQdKsdPiN38/DViO7/6HP/wa/G3wyo9bYZOwZBw3jmcyaB43U/PYlaEdrBE47ehDsAcx1TXpifyEBuoHk8rjejZQQc41dSgBrB2/ImL7/0vnKjr3qw9U5mSWzSvGHeT1rOxX4hbMCgO7hWlb5VUGUf9BfaAkzp2FwAzIFcWo/drmp64faNu9RLW0ppxSOoBVkX+tQxD+lA5Qm0GbTsGUYkTvURfrBo3p3d1gWm2Ztm4OU/Fg+gUun4Z2dzZ8+qfLf1zCohHoNPRibQW9knzYZrNq6rI7Gh9Z0AVytO49genjsBajkZGvEFvoQ2HRYA7+68wJVYZgXfxQF3tY+horq5oCBEzd9Ps25K+KzBso2ZTJKl4MB/pUmwZ7mf7ZhrH5VSBqBkUz7YnxdxByz2xPcVPMuwd46hLaekw9Oys6obQLo9VHOfKD8N72YECgF/THagmI86ZJDPklgWDml6QfOAefQ87AH7dTSw4gkQlVIMvx4C57A1tqoikzS3R5cJCO5QQ9Ul2MMhGsNz5VBSuuWLftU4yzEC4LFY/5vsShb1LihRhoRFdXYWg+LziNhZSBAOr4h988BwrxP+ph029T+/d7WsvmCc9N2VWVPTlA5kUVl3KLAl0fb+4Li4m9cBOJa233N0tIj7qJyWmyx6/2tgXHrczqm5E3XxExMo+0eLlo1GcZ4XczURU7jV6ArnJJ7YlqDXcKuuVaWbmEgJlVsu+FEKPqEZ7D/KKd6WVkpOc0x1DL+01MbtKsdjwgVzyezSL4u7IwspAyWa/US07GH3SmhYtVLixbZDr307IUi0i8wCI4OrRJltiPbRYoE398QBosbI5KMym+XapB+xobnbuvYs9n4P9Z0xzpkleLJ7vNAFRAxNHUvYsb+7U9FXRQZoCzDZfCAPj+7GYkbOjm0MrKgfVLaVfMaETjMuNlPmBSrybFkh7bjlYJMxfDOylf0hSJuYOoKRd85o5z2XjFikGU/f/OLgZDDCoBiOKpc9MgNaV1oGjoe1GEQEeQkKvKfuPx478faMAzkJou+pCsJyz3E9Cx6RL+2MJsn9u/oQk/svc17BX7UwBSN5bAv41rXW3w0FZpUlfqIE0SCDnqzp2FbYXHA2jss3S93nwDGhNU04I6JmQicek8r3652dzuQD2lz8aC7JyqGpSOJvlS+FHquDERDIgXHr4dr+ARHwJmksZvb5DIaEmeS7NMin3jS+sKQuqyztrHtmzCYlUpnGTFF6YAusmiywjZyfqnl95IzAwmcUDIgGi8Owsd61gCDyJYL+X/soOSeptiygQ0qqN3kvIplhlIucm3/D3aBsP7U9lt2sA9UJuHFpD351Vix6EQZZtlvyD183TrHavurOhuvYLPOVNEWAV6XCu6TT7V1cEY82KC/CPQi5YuKqfbIgqhg3bEizPS1Kj+eM6LRc/+S7WQVtcEAMXA7oKxilMng+1QjH9mdj8t5Fc8MdwHokeXg2wDkY2YF+roTLaPTlzvv2WRGxVAESShWoxhoYXIXj/R4oPo7g9RGdPlf7S/r22BZphUgnISyPq5NUxWNTmWzRws+PKNPe+6m7ioy3BxUeclMJn+BNeJ33bsJsmWsBZLl0bXcJhm27cnh5pC/UQwxGrD0AvUiFO2sYh13M2Dh0XDjNp0b7mZnlj/HZb3vS5j3rno9YJDvVwOfL2pfnomSHRMCEA6gcRhd+NV3BmORcp7MsIf31zRfuVgREDpQldIx3VIEIamwGvkdCbYDjkT81Zukhp3qkH2Icv4egrNzI8ETeaqRUdAM28If83yFPeB1ZiGsU+wp0BvSQtJMmFyTKzs3u+fdYrJ13zJWHc7B6fNMQUsckuKVEF3Hjzua9h2zjzsLB7PrvWL/KAbIvqPwPnP0sFty8huRP7iOfNXm3XoIQYx87EmtW22z2iFb9QcL8YIzdHmkqwkKxRfnJeVv4RpCwpOxn+fY4SmHDktPeJWqwHJOp3OZTnohrwuq8wUkCNjQ3pNk/SKaw8TulyFczyHj8HMOMgKbjggVpEbtKGD4twxl96Mrtk9GSd5uLkOYOleCahd/blzUukXwrlW8xYM0QwaI/IU2RvfiNx2AhXrD85EQgZFfQhmpneizP06s764kuBwm2JwTKocgLLrWlvKCVej6MGSWePowTBFBIeoBN+LLI9AJipwfYuWEnxt5BtxHrMnndpg0CwFm+ZisW1lnyAtLZHJ6hx2BGvw/SOnb+wOcFkrloE6y3Kavh2pY+vPHuXGYTk2e+oS0ooIf6Jz+5DxhjseGQbzm6qskdJVjWjrJ4DvNXghgs0Akr4VRtTo20imbSr42JuV9VReu6ovJtxQdZ4AvNEWGQ7Gyx59t1y5cZriWdmxxpxWRv2ZJg5apjFFTBQEtiDsNvD5paRzLmJnf7X+XMMilkClyjDzcLBOAKGyX2lm9OiEjYRrwbbsyNYsWuwZnfOJPKxxYQnPCpFYTS/8nIPeC/Pm6C7/NzupK/wS+QN4P0hZhhbttNTUN4S16AmQ2YoFEGeTrrBdqARCCIA/RufuoSrh3+GS45svcKYByGvsxXzsa/IkplWUp5e0oY8rcZo6mfY8sS2a2tZlkt+RB3AkTlTnbXbvTQ8gh4sCd+cHUlpxHZg40b22aBOideSzQPZAaxWapig7fndkmquUUcOqWQlzqZmhPhaKXW4tW0oM6+JSPMWEa+hMbpJa9e/NuJW2AEEe6zonKNtxi+2syFb3SXtxrA185yTBOpR9YrMH81pmpl0iuWp9+FPK39Fg03z/niEg2NefemCv92Hsk4Y9tyPryo3/i4UaUcDnOsRE4/ZjUAQVYgWws5BucUOAqizszvWVkiY4sDVEl0ChA4+6JgFIlZJJd05PTc4OJNUOI+zLsVU32lJ1GsN0DAmTe8JADDBmXr8k09XO+KgpagwrORU4ZZrlsqOc2W6eLn2XDwdu0B5Ykj65HLWX4iASEkVzx7qZ3/phuXB2z8Q9SRzAmrbq3QW/ZG+osNDf/7UPank9No/0a3pDNfL8bKYiYjHjSCL6fqumH9uoBu7W8zQrWSCh5RHm8OLPHPSMP6p85RkKH60rdIjAZ5dcfDLC0v0AaVQGS9Ha/4Pyt1qaAfHJrw/oHypm6+AaufNs46KCQZ+W9tk6eQuzwPYoD1FeJY2itjizp98GX4aTvGLwuk2288ohtWoTWhs21OSC4Nys/Cpyi4A4AprDQgwJLVCbjymIlAXGIJP8hMXCFB+pybF92KO+KxrOTHvte7+HGYC9C1+XGFNhEXwF++HFblFPxDHvQ4eRX/YAFMkkGdlZRBxhcnbKBTCu8TyoP9KVSe5EaVlKb+jvbsyuNMarL1nQ6/AaZV3C9NDUrd2iBVlpIEpDhwcFhfHeRwonzSVn4dheSRAzVVPTzZimJzHykvyK1ZR+7WwRJFeM5N+oUox7aFV7d5sBkYnXYs3su1L0CK9mBylGWOOzeNYqWn1gULm84wUW7SLlkC+v988IhHvCmVtGALgnCXQ1zL8QyNCpVy2GEGu9nawEHT+IAEcfB1dltSqWqIC/inYoLLAw1l1LIAqeQ96kPOjz0xo4sejrbO6RQh5AZwP3ZQ"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>