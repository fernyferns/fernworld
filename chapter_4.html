<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"m8oxfPb8f7jriPA5bBYjaw==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"q/JLYWZTrII=","ct":"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"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>