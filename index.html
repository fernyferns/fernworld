<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"2O4xgfChbSLwnyB+Uxcw3Q==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"9yXl9RbCtec=","ct":"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"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>