<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"JFdUBJIoCUmx59+YHPKMkA==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"9yXl9RbCtec=","ct":"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"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>