<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"pTZFAglfOwUi6BfRUxW4Pg==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"Ixabti4G6l0=","ct":"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"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>