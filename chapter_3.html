<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"lOdc/qpXaPyfzPHUUX6UjA==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"q/JLYWZTrII=","ct":"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"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>