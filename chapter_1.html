<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"pwpHIqe7kyfShf1hY0kXDQ==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"9yXl9RbCtec=","ct":"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"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>