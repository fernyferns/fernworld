<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"x5rI7XlHilwpRIl/6poBUg==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"Ixabti4G6l0=","ct":"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"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>