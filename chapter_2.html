<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"+RtEOGmIals9NSUCL8frig==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"9yXl9RbCtec=","ct":"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"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>