<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex">
    <title>Fernworld</title>
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chilanka&display=swap" rel="stylesheet">
    <style>
        html {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
            margin-left: 2em;
            margin-right: 2em;
            max-width: 800px;
        }

        * {
            font-family: 'Chilanka';
        }

        p {
            margin-bottom: 1.3em;
        }

        .alert {
            background-color: lemonchiffon;
        }
    </style>
    <script src="./sjcl.js"></script>
</head>

<script>

    var alertShown = false;

    function login(manualLogin = false) {

        var password = "";

        try {

            if (manualLogin) {
                password = document.getElementById("password").value || "";
                localStorage.setItem("password", password);
                decryptAndRender(password);
                return;
            }

            else {

                //check if password is in query string
                password = getParameterByName("password");
                if (password) {
                    localStorage.setItem("password", password);
                    decryptAndRender(password);
                    return;
                }

                //check if password is already in storage
                password = localStorage.getItem("password");
                if (password) {
                    decryptAndRender(password);
                    return;
                }

            }

        } catch (error) {
            //clear session storage on error.
            localStorage.removeItem("password");
            if (error) {
                if (error.message == "ccm: tag doesn't match") {
                    showAlert("Password incorrect");
                } else if (error.message) {
                    showAlert(error.message);
                } else {
                    showAlert("Something went wrong.");
                }
            }
        }

    }

    function decryptAndRender(password) {
        var decryptedHtmlPage = sjcl.decrypt(password, encryptedHtml);
        document.open("text/html", "replace");
        document.write(decryptedHtmlPage);
        document.close();
    }

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function showAlert(message) {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert" class="alert" onClick="dismissAlert()"><a href="#" onClick="dismissAlert()">[x]</a>&nbsp;&nbsp;${message}</p>`;
            alertShown = true;
        }
    }

    function dismissAlert() {
        var container = document.getElementById("alert");
        if (container) {
            container.outerHTML = `<p id="alert"></p>`;
            alertShown = false;
        }
    }

    function passwordKeyPress(event) {
        if (alertShown) {
            dismissAlert();
        }
        if (event.key == "Enter") {
            login(true);
        }
    }

    var encryptedHtml = '{"iv":"2LwmyKlbTslx2sj/guDUPg==","v":1,"iter":10000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"q/JLYWZTrII=","ct":"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"}';

    login();


</script>

<body onload="onLoad()">

    <noscript>
        <p class="alert">This site requires JavaScript to function. Login will not function without scripts enabled.</p>
    </noscript>

    <p id="alert"></p>

    <h1>
        Login
    </h1>

    <div>
        <label for="password">Password</label>
        <input type="password" id="password" required disabled onkeypress="passwordKeyPress(event)" />
        <p>Ask Fern if you don't know the password.</p>
    </div>

    <p>
        <button disabled type="button" id="loginBtn" onclick="login(true)">
            Login
        </button>
    </p>

    <script>

        function onLoad() {

            //enable login button.
            document.getElementById("loginBtn").removeAttribute("disabled");
            document.getElementById("password").removeAttribute("disabled");

            login();

        }

    </script>

</body>

</html>